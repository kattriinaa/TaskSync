<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskSync with Vue.js</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Кнопка Logout -->
        <button v-if="isAuthenticated" class="logout-btn" @click="logout">Logout</button>

        <!-- Реєстраційна/логін форма -->
        <div v-if="!isAuthenticated">
            <h1>Login to TaskSync</h1>
            <form @submit.prevent="login">
                <input type="text" v-model="credentials.username" placeholder="Username" required>
                <input type="password" v-model="credentials.password" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
        </div>

        <!-- Список задач -->
        <div v-else>
            <h1>TaskSync</h1>
            <h2>Your Tasks</h2>
            <ul>
                <li v-for="task in tasks" :key="task.id">
                    <strong>{{ task.title }}</strong> - {{ task.description }}
                    (Due: {{ task.due_date }}, Priority: {{ task.priority }})
                    <button @click="deleteTask(task.id)">Delete</button>
                </li>
            </ul>

            <h2>Add a New Task</h2>
            <form @submit.prevent="addTask">
                <input type="text" v-model="newTask.title" placeholder="Title" required>
                <input type="text" v-model="newTask.description" placeholder="Description" required>
                <input type="date" v-model="newTask.due_date" required>
                <select v-model="newTask.priority">
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                </select>
                <button type="submit">Add Task</button>
            </form>
        </div>
    </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    isAuthenticated: false, // Стан авторизації
                    credentials: { username: '', password: '' }, // Дані для логіну
                    tasks: [], // Список задач
                    newTask: { title: '', description: '', due_date: '', priority: 'Low' } // Нова задача
                };
            },
            methods: {
                async login() {
                    if (this.credentials.username === 'kattrina' && this.credentials.password === 'tasksyncc') {
                        this.isAuthenticated = true;
                        localStorage.setItem('isAuthenticated', true); // Зберігаємо статус авторизації
                        this.fetchTasks();
                    } else {
                        alert('Invalid username or password');
                    }
                },
                logout() {
                    this.isAuthenticated = false;
                    localStorage.removeItem('isAuthenticated'); // Видаляємо статус авторизації
                    this.credentials = { username: '', password: '' };
                },
                async fetchTasks() {
                    const response = await axios.get('/api/tasks');
                    this.tasks = response.data;
                },
                async addTask() {
                    const response = await axios.post('/api/tasks', this.newTask);
                    this.newTask = { title: '', description: '', due_date: '', priority: 'Low' };
                    this.fetchTasks();
                },
                async deleteTask(id) {
                    const response = await axios.delete(`/api/tasks/${id}`);
                    this.fetchTasks();
                }
            },
            mounted() {
                const authStatus = localStorage.getItem('isAuthenticated');
                console.log('Auth status in Local Storage:', authStatus); // Додано для перевірки
                if (authStatus === 'true') {
                    this.isAuthenticated = true;
                    this.fetchTasks();
                } else {
                    this.isAuthenticated = false;
                }
            }
            
        });
    
        app.mount('#app');
    </script>
    
</body>
</html>
